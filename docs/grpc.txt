GRPC is implemented between Person and Connection Modules.

When API endpoint '/persons/<person_id>/connection' is called using POST method, it triggers a gRPC client call to gRPC server at Connection module.

At the server side it's implemented a method to search the postgres database the User Connection information. Multiple requests are
made to search all posible connections for the user of interest and each response is appended to gRPC response message.

GRPC server runs at port 50051 at service udaconnect-connection. Folder "modules/grpc" holds .proto file and files generated by .proto compilation.

To make a sample request a python client script is provided. It will search for service 'udaconnect-service:50051' and search for a user. When executing
this under linux, add coredns server to /etc/resolv.conf so that the service name can be found.

python udaconnect_grpc_client.py

Script:

import grpc
import udaconnect_pb2
import udaconnect_pb2_grpc

def run_grpc_client():

    start_date = '2018-01-01'
    end_date = '2022-12-30'
    distance = 500

    #with grpc.insecure_channel("udaconnect-connection:50051") as channel:
    with grpc.insecure_channel("localhost:50051") as channel:
        stub = udaconnect_pb2_grpc.udaConnectStub(channel=channel)
        response = stub.getCloseConnections(udaconnect_pb2.ConnectionDataRequest(id=5, start_date = start_date, end_date=end_date, distance=distance))
        for a in response.ConnectionDataResponse:
            print(a.id)

run_grpc_client()


--------------------------------------------------------------------------
.proto file:


service udaConnect {
    rpc getCloseConnections (ConnectionDataRequest) returns (ConnectionDataReply) {}
}

message ConnectionDataRequest { 
    uint32 id = 1;
    string start_date = 2;
    string end_date = 3;
    uint32 distance = 4;
}

message ConnectionDataReply {
    repeated ConnectionData ConnectionDataResponse = 1;
}

message ConnectionData {
    uint32  id = 1;
    uint32  location_id = 2;
    float    coord_x = 3;
    float    coord_y = 4;
    string  creation_time = 5;
}